<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cotizaciones y Ventas</title>
    
    <!-- Librer√≠as externas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- ==================== PANTALLA DE LOGIN ==================== -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h1>Sistema de Cotizaciones</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label>Tipo de Usuario</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button type="button" class="btn btn-primary role-selector active" data-role="admin" onclick="selectRole('admin')">üë®‚Äçüíº Administrador</button>
                        <button type="button" class="btn btn-primary role-selector" data-role="vendedor" onclick="selectRole('vendedor')">üë§ Vendedor</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Iniciar Sesi√≥n</button>
                <div id="loginError" class="error-message hidden"></div>
            </form>
        </div>
    </div>

    <!-- ==================== APLICACI√ìN PRINCIPAL ==================== -->
    <div id="app">
        <!-- Header -->
        <div class="app-header">
            <div class="company-info">
                <img id="companyLogo" class="company-logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect fill='%23ecf0f1' width='100' height='100'/%3E%3Ctext x='50%25' y='50%25' font-size='14' text-anchor='middle' dy='.3em' fill='%237f8c8d'%3ELOGO%3C/text%3E%3C/svg%3E" alt="Logo">
                <div class="company-details">
                    <h2 id="companyName">Nombre de la Empresa</h2>
                    <p id="companySlogan">Eslogan de la empresa</p>
                    <p id="companyNit" class="company-nit" style="display: none;"></p>
                </div>
            </div>
            <div class="header-actions">
                <button id="configBtn" class="btn btn-secondary" onclick="openCompanySettings()">‚öôÔ∏è Configuraci√≥n</button>
                <button id="inventoryBtn" class="btn btn-secondary" onclick="openInventory()">üì¶ Inventario</button>
                <button id="salesBtn" class="btn btn-secondary" onclick="openSales()">üí∞ Ventas</button>
                <button id="historyBtn" class="btn btn-secondary" onclick="openHistory()">üìã Historial</button>
                <div class="quote-number">
                    <span id="quoteNumber">N¬∫ 100000</span>
                </div>
                <button class="btn btn-danger" onclick="logout()">Salir</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Document Type Toggle -->
            <div class="type-toggle">
                <button class="btn btn-primary active" onclick="setDocumentType('cotizacion')">Cotizaci√≥n</button>
                <button class="btn btn-primary" onclick="setDocumentType('notaventa')">Nota de Venta</button>
            </div>

            <!-- Client Section -->
            <div class="section">
                <h3 class="section-title">Datos del Cliente</h3>
                <div class="selection-area">
                    <div class="form-group">
                        <label for="clientSelect">Cliente</label>
                        <div class="autocomplete-container">
                            <input type="text" id="clientSelect" class="autocomplete-input" placeholder="Buscar o seleccionar cliente..." oninput="filterClients(this.value)" onfocus="showClientList()">
                            <div id="clientList" class="autocomplete-list"></div>
                        </div>
                    </div>
                    <button class="btn btn-success" id="clientActionBtn" onclick="handleClientAction()">Agregar Cliente</button>
                </div>
            </div>

            <!-- Seller Section -->
            <div class="section">
                <h3 class="section-title">Datos del Vendedor</h3>
                <div class="selection-area">
                    <div class="form-group">
                        <label for="sellerSelect">Vendedor</label>
                        <div class="autocomplete-container">
                            <input type="text" id="sellerSelect" class="autocomplete-input" placeholder="Buscar o seleccionar vendedor..." oninput="filterSellers(this.value)" onfocus="showSellerList()">
                            <div id="sellerList" class="autocomplete-list"></div>
                        </div>
                    </div>
                    <button class="btn btn-success" id="sellerActionBtn" onclick="handleSellerAction()">Agregar Vendedor</button>
                </div>
            </div>

            <!-- Products Section -->
            <div class="section">
                <h3 class="section-title">Productos</h3>
                <div class="product-input-area">
                    <div class="form-group">
                        <label for="productSelect">Producto</label>
                        <div class="autocomplete-container">
                            <input type="text" id="productSelect" class="autocomplete-input" placeholder="Buscar producto..." oninput="filterProducts(this.value)" onfocus="showProductList()">
                            <div id="productList" class="autocomplete-list"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="productQuantity">Cantidad</label>
                        <input type="number" id="productQuantity" min="1" value="1" oninput="updateProductPreview()">
                    </div>
                    <div class="form-group">
                        <label for="productDiscount">Descuento</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="productDiscount" min="0" value="0" oninput="updateProductPreview()">
                            <select id="discountType" onchange="updateProductPreview()">
                                <option value="%">%</option>
                                <option value="Bs">Bs</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Precio Unit.</label>
                        <input type="number" id="productPrice" min="0" step="0.01" value="0" oninput="updateProductPreview()">
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="addProductToQuote()">Agregar a Cotizaci√≥n</button>
                    <button class="btn btn-warning" id="productActionBtn" onclick="handleProductAction()">Nuevo Producto</button>
                </div>

                <table class="products-table" id="productsTable">
                    <thead>
                        <tr>
                            <th>Img</th>
                            <th>#</th>
                            <th>C√≥digo</th>
                            <th>Descripci√≥n</th>
                            <th>Cantidad</th>
                            <th>Precio Unit.</th>
                            <th>Descuento</th>
                            <th>Subtotal</th>
                            <th>Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody"></tbody>
                </table>
            </div>

            <!-- Totals Section -->
            <div class="totals-section">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span id="subtotalAmount">Bs 0.00</span>
                </div>
                <div class="total-row">
                    <span>Descuento Total:</span>
                    <span id="discountAmount">Bs 0.00</span>
                </div>
                <div class="total-row grand-total">
                    <span>TOTAL:</span>
                    <span id="totalAmount">Bs 0.00</span>
                </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="section terms-area">
                <h3 class="section-title">T√©rminos y Condiciones</h3>
                <div class="terms-list">
                    <div class="form-group">
                        <label>T√©rmino 1</label>
                        <textarea id="term1"></textarea>
                    </div>
                    <div class="form-group">
                        <label>T√©rmino 2</label>
                        <textarea id="term2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>T√©rmino 3</label>
                        <textarea id="term3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>T√©rmino 4</label>
                        <textarea id="term4"></textarea>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="newQuote()">Nueva Cotizaci√≥n</button>
                <button class="btn btn-primary" onclick="generatePDF()">Generar PDF</button>
            </div>
        </div>
    </div>

    <!-- ==================== MODALES ==================== -->
    
    <!-- Company Settings Modal -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configuraci√≥n de la Empresa</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nombre de la Empresa</label>
                    <input type="text" id="modalCompanyName">
                </div>
                <div class="form-group">
                    <label>Eslogan</label>
                    <input type="text" id="modalCompanySlogan">
                </div>
                <div class="form-group">
                    <label>NIT</label>
                    <input type="text" id="modalCompanyNit">
                </div>
                <div class="form-group">
                    <label>Logo</label>
                    <label for="logoInput" class="file-input-label">üìÅ Cargar Logo</label>
                    <input type="file" id="logoInput" accept="image/*" onchange="handleLogoUpload(event)">
                    <img id="logoPreview" style="max-width: 200px; margin-top: 10px; display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('companyModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveCompanySettings()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="clientModalTitle">Agregar Cliente</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nombre *</label>
                    <input type="text" id="modalClientName" required>
                </div>
                <div class="form-group">
                    <label>Tel√©fono</label>
                    <input type="text" id="modalClientPhone">
                </div>
                <div class="form-group">
                    <label>CI/NIT</label>
                    <input type="text" id="modalClientCI">
                </div>
                <div class="form-group">
                    <label>Empresa</label>
                    <input type="text" id="modalClientCompany">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('clientModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveClient()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Seller Modal -->
    <div id="sellerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="sellerModalTitle">Agregar Vendedor</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Nombre *</label>
                    <input type="text" id="modalSellerName" required>
                </div>
                <div class="form-group">
                    <label>Celular</label>
                    <input type="text" id="modalSellerPhone">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('sellerModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveSeller()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Nuevo Producto</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>C√≥digo</label>
                    <input type="text" id="modalProductCode">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n *</label>
                    <input type="text" id="modalProductDescription" required>
                </div>
                <div class="form-group">
                    <label>Precio Unitario</label>
                    <input type="number" id="modalProductPrice" min="0" step="0.01" value="0">
                </div>
                <div class="form-group">
                    <label>Costo Unitario</label>
                    <input type="number" id="modalProductCost" min="0" step="0.01" value="0">
                </div>
                <div class="form-group">
                    <label>Cantidad en Stock</label>
                    <input type="number" id="modalProductStock" min="0" step="0.01" value="0">
                </div>
                <div class="form-group">
                    <label>Imagen del Producto</label>
                    <label for="productImageInput" class="file-input-label">üìÅ Cargar Imagen</label>
                    <input type="file" id="productImageInput" accept="image/*" onchange="handleProductImageUpload(event)">
                    <img id="productImagePreview" style="max-width: 200px; margin-top: 10px; display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('productModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveProduct()">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal">
        <div class="modal-content" style="max-width: 95%; width: 95%;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3>Historial de PDFs Generados</h3>
                <button class="btn btn-secondary" onclick="closeModal('historyModal')" style="margin: 0;">‚úï Cerrar</button>
            </div>
            <div class="modal-body">
                <div id="historyContent">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Tipo</th>
                                <th>N¬∫ Doc.</th>
                                <th>Cliente</th>
                                <th>Vendedor</th>
                                <th>Total</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody"></tbody>
                    </table>
                </div>
                <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="prevHistoryPage()" id="prevPageBtn">‚óÄ Anterior</button>
                    <span id="pageInfo" style="font-weight: bold;">P√°gina 1</span>
                    <button class="btn btn-secondary" onclick="nextHistoryPage()" id="nextPageBtn">Siguiente ‚ñ∂</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div id="inventoryModal" class="modal">
        <div class="modal-content" style="max-width: 95%; width: 95%;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3>üì¶ Inventario de Productos</h3>
                <button class="btn btn-secondary" onclick="closeModal('inventoryModal')" style="margin: 0;">‚úï Cerrar</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div>
                        <div style="font-size: 14px; color: #666;">Costo Total del Inventario</div>
                        <div style="font-size: 24px; font-weight: bold; color: #e74c3c;" id="totalCostInventory">Bs 0.00</div>
                    </div>
                    <div>
                        <div style="font-size: 14px; color: #666;">Precio Total del Inventario</div>
                        <div style="font-size: 24px; font-weight: bold; color: #27ae60;" id="totalPriceInventory">Bs 0.00</div>
                    </div>
                    <div>
                        <button class="btn btn-success" onclick="handleProductAction()">‚ûï Nuevo Producto</button>
                        <button class="btn btn-primary" onclick="generateInventoryPDF()">üìÑ Descargar PDF</button>
                    </div>
                </div>
                <div id="inventoryContent">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>Img</th>
                                <th>C√≥digo</th>
                                <th>Descripci√≥n</th>
                                <th>Stock</th>
                                <th>Costo Unit.</th>
                                <th>Precio Unit.</th>
                                <th>Costo Total</th>
                                <th>Precio Total</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Sales Modal -->
    <div id="salesModal" class="modal">
        <div class="modal-content" style="max-width: 95%; width: 95%;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h3>üí∞ Reporte de Ventas</h3>
                <button class="btn btn-secondary" onclick="closeModal('salesModal')" style="margin: 0;">‚úï Cerrar</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="flex: 1;">
                        <label style="font-size: 14px; color: #666; display: block; margin-bottom: 5px;">Seleccionar Mes</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="month" id="salesMonthFilter" onchange="filterSalesByMonth()" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                            <button class="btn btn-secondary" onclick="showAllSales()" style="padding: 8px 15px; font-size: 14px;">Ver Todas</button>
                        </div>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <div style="font-size: 14px; color: #666;">Costo Total</div>
                        <div style="font-size: 24px; font-weight: bold; color: #e74c3c;" id="totalCostSales">Bs 0.00</div>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <div style="font-size: 14px; color: #666;">Precio Total</div>
                        <div style="font-size: 24px; font-weight: bold; color: #27ae60;" id="totalPriceSales">Bs 0.00</div>
                    </div>
                    <div style="flex: 1; text-align: center;">
                        <div style="font-size: 14px; color: #666;">Balance</div>
                        <div style="font-size: 24px; font-weight: bold; color: #3498db;" id="balanceSales">Bs 0.00</div>
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="generateSalesPDF()">üìÑ Descargar Resumen</button>
                    </div>
                </div>
                <div id="salesContent">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>N¬∫ Venta</th>
                                <th>Cliente</th>
                                <th>Vendedor</th>
                                <th>Productos</th>
                                <th>Costo</th>
                                <th>Precio</th>
                                <th>Ganancia</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== SCRIPTS ==================== -->
    <script src="js/firebase-config.js"></script>
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/company.js"></script>
    <script src="js/clients.js"></script>
    <script src="js/sellers.js"></script>
    <script src="js/products.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/sales.js"></script>
    <script src="js/quotes.js"></script>
    <script src="js/pdf.js"></script>
    <script src="js/history.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
